{% extends "site_base.html" %}
{% load search_utils %}
{% block style %}
  {{ block.super }}
  <link rel=stylesheet type=text/css href="{{ STATIC_URL}}style/search.css">
{% endblock %}

{% block content %}
  <h1>Search results</h1>

  {% if search_terms or active_filters %}
    <p>You searched for
      {% for term in search_terms %}
        <strong>{{ term }}</strong>{% if not forloop.last %}, {% endif %}
      {% empty %}
        all articles
      {% endfor %}
      {% if active_filters %} with filters:  {# display active filters #}
        {% for filter, urlopt in active_filters %}
          {{ filter }} <a href="?{{ urlopt }}">(x)</a> {# link to remove filter #}
        {% endfor %}
      {% endif %}
    </p>

  {% endif %}

  {% with total=results.paginator.count %}
  {% if total %}
   <p>Found {{ total }} article{{ total|pluralize }}.</p>
  
   <ul>
     {% for article in results.object_list %}
         <li>{% include  'publication/snippets/list_article.html' %}</li>
     {% endfor %}

   {% pagination_links results show_pages url_params %}
  </ul>

  {% else %}
    <p>Your search term{{ search_terms|pluralize }} did not match any articles.</p>
  {% endif %}
  {% endwith %}

{% endblock %}

{% block sidebar-left-search %}
  {{ block.super }}
     {% if search_within %}
         <div id=site-search-within-form class=block>
             <form method=get action="{% url publication:search %}">
                 {{ search_within.within_keyword }}
                 {# used to store the previous search terms #}
                 {{ search_within.keyword.as_hidden }}
                 {{ search_within.past_within_keyword.as_hidden }}
                 <input type=submit value="Search within result" class=submit>
              </form>
         </div>
     {% endif %}
{% endblock %}
{% block sidebar-left %}
  {{ block.super }}
  {% if facets %}
    <div id="search-facets" class="block">
      <h2>Filter search results</h2>
      {% for field, values in facets.iteritems %}
        <h3>{{ field|capfirst }}</h3> {# label for a group of facet values #}
        <ul>
        {% for f in values %} {# values is a list of tuples of value, count #}
          <li><a href="?{{url_params}}&amp;{{field}}={{f.0}}">{{ f.0 }}</a> ({{ f.1 }})</li>
        {% endfor %}
        </ul>
      {% endfor %}
    </div>
  {% endif %}
{% endblock %}