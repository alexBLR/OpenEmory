{% extends "site_base.html" %}

{% block page-subtitle %}{{ block.super }} | {% firstof obj.label obj.pid %} | Edit{% endblock %}
{% block style %} {{ block.super }}
  <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}/style/edit.css" />
{% endblock %}
{% block scripts %} {{ block.super }}
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery.fadingMessage.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery.userLookup.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
     $(".netid-lookup").userLookup({
     	url: "{% url accounts:user-name 'USERNAME'%}",
        url_replace: "USERNAME",
      });
  });
</script>
{% endblock %}

{% block content %}
<h1>Edit Record</h1>
<p class="info">Created {{ obj.created }}; last modified {{ obj.modified }}</p>

<form method="post">{% csrf_token %}
  {{ form.non_field_errors }}
  <div id="title_info" class="subform">  {# title information #}
    <p class="label">{{ form.subforms.title_info.form_label }}</p>
    {{ form.subforms.title_info.as_p }}
  </div>
  <div id="authors" class="subform"> {# authors #}
    <p class="label">{{ form.formsets.authors.form_label }}</p>
    {{ form.formsets.authors.management_form }} 
    {# TODO: add some preliminary instructions about authors here; #}
    {# specifically, instruct to edit Emory directory name to match publication name #}
    {% for authorform in form.formsets.authors %} {# needs subdiv for js updating #}
       <div> {{ authorform.as_p }} </div>
    {% endfor %}
  </div>
  <div id="funders" class="subform"> {# funding agency #}
    <p class="label">{{ form.formsets.funders.form_label }}</p>
    {{ form.formsets.funders.as_p }} {# TODO: customize delete #}
  </div>
  <hr/> {# article version - top level field, not sure where to display #}
  <p>{{ form.version.errors }}
        <label for="id_{{ form.version.id }}">{{ form.version.label }}:</label>
        {{ form.version }}
  </p>
  <p class="pubdate">{{ form.publication_date.errors }}
        <label for="id_{{ form.publication_date.id }}">{{ form.publication_date.label }}:</label>
        {{ form.publication_date }}
  </p>
  <div id="journal_info" class="subform"> {# journal info #}
    <p class="label">{{ form.subforms.journal.form_label }}</p>
    {% for field in form.subforms.journal %}
      <p> {{ field.errors }}
        <label for="id_{{ field.id }}">{{ field.label }}:</label>
        {{ field }}
      </p>
    {% endfor %}
    {% with form.subforms.journal.subforms.volume as subform %} {# volume number #}
      <p> {{ field.errors }}
        <label>{{ subform.form_label }}:</label>      
        {{ subform.number }}
      </p>
    {% endwith %}
    {% with form.subforms.journal.subforms.number as subform %} {# issue number #}
      <p> {{ field.errors }}
        <label>{{ subform.form_label }}:</label>      
        {{ subform.number }}
      </p>
    {% endwith %}
    {% with form.subforms.journal.subforms.pages as subform %} {# pages #}
      <p class="pages">
        {{ subform.non_field_errors }}
        <label>{{ subform.form_label }}:</label>      
        {{ subform.start }} - {{ subform.end }}
      </p>
    {% endwith %}
  </div>
  <div id="final_version" class="subform">  {# final version URL/DOI #}
    <p class="label">{{ form.subforms.final_version.form_label }}</p>
    {{ form.subforms.final_version.as_p }}
  </div>

  <div id="abstract" class="subform"> {# abstract #}
    <p class="label">{{ form.subforms.abstract.form_label }}</p>
    {{ form.subforms.abstract.as_p }} 
  </div>
  <div id="author_notes" class="subform"> {# author notes #}
    <p class="label">{{ form.formsets.author_notes.form_label }}</p>
    {{ form.formsets.author_notes.as_p }} {# TODO: customize delete #}
  </div>
  <div id="keywords" class="subform"> {# keywords #}
    <p class="label">{{ form.formsets.keywords.form_label }}</p>
    {{ form.formsets.keywords.as_p }} {# TODO: customize delete #}
  </div>
  <div id="other-urls" class="subform"> {# other version URLs #}
    <p class="label">{{ form.formsets.locations.form.form_label }}</p>
    <p class="helptext">Other versions of this  article (e.g., 
    	in PubMed or another repository)</p>
    {{ form.formsets.locations.as_p }}
  </div>

  <input type="submit" value="Publish"/>
</form>
{% endblock %}